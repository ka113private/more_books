<div class="modal fade" id="recommend-books-owned-category-select-modal" tabindex="-1" aria-labelledby="RecommendBooksOwnedCategorySelectModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div class="row">
                        <div class="col-md-6">
                            <img class="card-img-top" id="thumbnail-image" src="" alt="">
                        </div>
                        <div class="col-md-6">
                            <div class="row">
                                <div id="book_detail"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer" id="modal-footer">
            </div>
        </div>
    </div>
</div>

<script  type="text/javascript">
    const bookContainer = document.getElementById('book_detail');
    var footerContainer = document.getElementById('modal-footer');
    var thumbnailImage = document.getElementById('thumbnail-image');
    var bookElement = document.createElement('div');

    {% if exists  %}
        var bookList = JSON.parse('{{ recommend_books_owned_category | escapejs}}');//エスケープ文字を無視して、JSONデータからリストを取得する。
        var firstbook = bookList.books[0];//リストの先頭オブジェクトを取得する。
        bookElement.innerHTML = `<h6>${firstbook.title}</h6><p>${firstbook.author}</p>`;
        footerContainer.innerHTML  = `<button class="btn btn-primary" id="add-mybooks" >読みたい</button><button class="btn btn-secondary" id="not-add-mybooks" >興味ない</button>`
        thumbnailImage.src = './../media/' + firstbook.thumbnail_image;
        bookContainer.appendChild(bookElement);

    {% else %}
        bookElement.innerHTML = `<p>おすすめできる本はございません。しばらく時間がたってからまたお試しください。</p>`;
        footerContainer.innerHTML  = `<button class="btn btn-secondary" data-dismiss="modal" aria-label="Close">閉じる</button>`
        thumbnailImage.src = './../media/static/sorry.png';
        bookContainer.appendChild(bookElement);
    {% endif %}
</script>

    <!-- 次の書籍を表示（Ajax）-->
<script type="text/javascript">
        document.getElementById('add-mybooks').addEventListener('click', e => {
            let formdata = new FormData();
            const data = {};
            const jsonData = JSON.stringify(bookList);
            e.preventDefault();
            const url = '{% url "books:add_mybooks" %}';
            fetch(url, {
                method: 'POST',
                body: jsonData,
                headers: {
                    'Content-Type': 'application/json; charset=utf-8',
                    'X-CSRFToken': '{{ csrf_token }}',
                    },
                }).then(response => {
                    return response.json();
                }).then(data => {
                    if(data.exists){
                        bookList = JSON.parse(data.next_books);//JSONデータからリストを取得する。
                        var next_book = bookList.books[0];//リストの先頭オブジェクトを取得する。
                        thumbnailImage.src = './../media/' + next_book.thumbnail_image;
                        bookElement.innerHTML = `<h6>${next_book.title}</h6><p>${next_book.author}</p>`;
                    }else{
                        bookElement.innerHTML = `<p>おすすめできる本は他にございません。しばらく時間がたってからまたお試しください。</p>`;
                        thumbnailImage.src = './../media/static/sorry.png';
                        footerContainer.innerHTML  = `<button class="btn btn-secondary" data-dismiss="modal" aria-label="Close">閉じる</button>`
                    }
            }).catch(error => {
                console.log(error);
        });
      });
</script>